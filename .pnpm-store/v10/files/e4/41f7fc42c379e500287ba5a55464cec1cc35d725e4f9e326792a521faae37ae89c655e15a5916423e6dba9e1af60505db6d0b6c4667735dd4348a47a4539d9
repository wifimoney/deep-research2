{"version":3,"sources":["../../src/test-utils/llm-mock.ts"],"names":["mockModel","MockLanguageModelV1","simulateReadableStream","MockLanguageModelV2","convertArrayToReadableStream","MastraLLMV1"],"mappings":"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","file":"llm-mock.cjs","sourcesContent":["import { simulateReadableStream } from 'ai';\nimport { MockLanguageModelV1 } from 'ai/test';\nimport { convertArrayToReadableStream, MockLanguageModelV2 } from 'ai-v5/test';\n\nimport { MastraLLMV1 } from '../llm/model/model';\n\nexport function createMockModel({\n  objectGenerationMode,\n  mockText,\n  spyGenerate,\n  spyStream,\n  version = 'v2',\n}: {\n  objectGenerationMode?: 'json';\n  mockText: string | Record<string, any>;\n  spyGenerate?: (props: any) => void;\n  spyStream?: (props: any) => void;\n  version?: 'v1' | 'v2';\n}) {\n  const text = typeof mockText === 'string' ? mockText : JSON.stringify(mockText);\n  const finalText = objectGenerationMode === 'json' ? JSON.stringify(mockText) : text;\n\n  if (version === 'v1') {\n    // Return a v1 model\n    const mockModel = new MockLanguageModelV1({\n      defaultObjectGenerationMode: objectGenerationMode,\n      doGenerate: async props => {\n        if (spyGenerate) {\n          spyGenerate(props);\n        }\n\n        return {\n          rawCall: { rawPrompt: null, rawSettings: {} },\n          finishReason: 'stop',\n          usage: { promptTokens: 10, completionTokens: 20 },\n          text: finalText,\n        };\n      },\n      doStream: async props => {\n        if (spyStream) {\n          spyStream(props);\n        }\n\n        // Split the mock text into chunks for streaming\n        const chunks = finalText.split(' ').map(word => ({\n          type: 'text-delta' as const,\n          textDelta: word + ' ',\n        }));\n\n        return {\n          stream: simulateReadableStream({\n            chunks: [\n              ...chunks,\n              {\n                type: 'finish',\n                finishReason: 'stop',\n                logprobs: undefined,\n                usage: { completionTokens: 10, promptTokens: 3 },\n              },\n            ],\n          }),\n          rawCall: { rawPrompt: null, rawSettings: {} },\n        };\n      },\n    });\n\n    return mockModel;\n  }\n\n  // Return a v2 model (default)\n  const mockModel = new MockLanguageModelV2({\n    doGenerate: async props => {\n      if (spyGenerate) {\n        spyGenerate(props);\n      }\n\n      return {\n        rawCall: { rawPrompt: null, rawSettings: {} },\n        finishReason: 'stop',\n        usage: { inputTokens: 10, outputTokens: 20, totalTokens: 30 },\n        content: [\n          {\n            type: 'text',\n            text: finalText,\n          },\n        ],\n        warnings: [],\n      };\n    },\n    doStream: async props => {\n      if (spyStream) {\n        spyStream(props);\n      }\n\n      return {\n        rawCall: { rawPrompt: null, rawSettings: {} },\n        warnings: [],\n        stream: convertArrayToReadableStream([\n          { type: 'stream-start', warnings: [] },\n          { type: 'response-metadata', id: 'id-0', modelId: 'mock-model-id', timestamp: new Date(0) },\n          { type: 'text-start', id: '1' },\n          { type: 'text-delta', id: '1', delta: finalText },\n          { type: 'text-end', id: '1' },\n          {\n            type: 'finish',\n            finishReason: 'stop',\n            usage: { inputTokens: 10, outputTokens: 20, totalTokens: 30 },\n          },\n        ]),\n      };\n    },\n  });\n\n  return mockModel;\n}\n\nexport class MockProvider extends MastraLLMV1 {\n  constructor({\n    spyGenerate,\n    spyStream,\n    objectGenerationMode,\n    mockText = 'Hello, world!',\n  }: {\n    spyGenerate?: (props: any) => void;\n    spyStream?: (props: any) => void;\n    objectGenerationMode?: 'json';\n    mockText?: string | Record<string, any>;\n  }) {\n    const mockModel = new MockLanguageModelV1({\n      defaultObjectGenerationMode: objectGenerationMode,\n      doGenerate: async props => {\n        if (spyGenerate) {\n          spyGenerate(props);\n        }\n\n        if (objectGenerationMode === 'json') {\n          return {\n            rawCall: { rawPrompt: null, rawSettings: {} },\n            finishReason: 'stop',\n            usage: { promptTokens: 10, completionTokens: 20 },\n            text: JSON.stringify(mockText),\n          };\n        }\n\n        return {\n          rawCall: { rawPrompt: null, rawSettings: {} },\n          finishReason: 'stop',\n          usage: { promptTokens: 10, completionTokens: 20 },\n          text: typeof mockText === 'string' ? mockText : JSON.stringify(mockText),\n        };\n      },\n      doStream: async props => {\n        if (spyStream) {\n          spyStream(props);\n        }\n\n        const text = typeof mockText === 'string' ? mockText : JSON.stringify(mockText);\n        // Split the mock text into chunks for streaming\n        const chunks = text.split(' ').map(word => ({\n          type: 'text-delta' as const,\n          textDelta: word + ' ',\n        }));\n\n        return {\n          stream: simulateReadableStream({\n            chunks: [\n              ...chunks,\n              {\n                type: 'finish',\n                finishReason: 'stop',\n                logprobs: undefined,\n                usage: { completionTokens: 10, promptTokens: 3 },\n              },\n            ],\n          }),\n          rawCall: { rawPrompt: null, rawSettings: {} },\n        };\n      },\n    });\n\n    super({ model: mockModel });\n  }\n\n  // @ts-ignore\n  stream(...args: any): PromiseLike<StreamReturn<any, any, any>> {\n    // @ts-ignore\n    const result = super.stream(...args);\n\n    return {\n      ...result,\n      // @ts-ignore on await read the stream\n      then: (onfulfilled, onrejected) => {\n        // @ts-ignore\n        return result.baseStream.pipeTo(new WritableStream()).then(onfulfilled, onrejected);\n      },\n    };\n  }\n\n  // @ts-ignore\n  __streamObject(...args): PromiseLike<StreamObjectResult<any>> {\n    // @ts-ignore\n    const result = super.__streamObject(...args);\n\n    return {\n      ...result,\n      // @ts-ignore on await read the stream\n      then: (onfulfilled, onrejected) => {\n        // @ts-ignore\n        return result.baseStream.pipeTo(new WritableStream()).then(onfulfilled, onrejected);\n      },\n    };\n  }\n}\n"]}